#ifndef _SWH_H_
#define _SWH_H_

#include "../../mb.h"

typedef struct
{
	// uint16_t S0=0;
	uint32_t A0 = 0;
	uint32_t A1 = 0;
	uint32_t A2 = 0;
	uint32_t A3 = 0;
	uint32_t A4 = 0;
	uint32_t A5 = 0;
	uint32_t A6 = 0;
	uint32_t A7 = 0;
	uint32_t A8 = 0;
	uint32_t A9 = 0;
	uint32_t A10 = 0;
	uint32_t A11 = 0;
	uint32_t A12 = 0;
	uint32_t A13 = 0;
	uint32_t A14 = 0;
	uint32_t A15 = 0;
	uint32_t A16 = 0;
	uint32_t A17 = 0;
	uint32_t A18 = 0;
	uint32_t A19 = 0;
	uint32_t A20 = 0;
	uint32_t A21 = 0;
	uint32_t A22 = 0;
	uint32_t A23 = 0;
	uint32_t A24 = 0;
	uint32_t A25 = 0;
	uint32_t A26 = 0;
	uint32_t A27 = 0;
	uint32_t A28 = 0;
	uint32_t A29 = 0;
	uint32_t A30 = 0;
	uint32_t A31 = 0;
	uint32_t A32 = 0;
	uint32_t A33 = 0;
	uint32_t A34 = 0;
	uint32_t A35 = 0;
	uint32_t A36 = 0;
	uint32_t A37 = 0;
	uint32_t A38 = 0;
	uint32_t A39 = 0;
	uint32_t A40 = 0;
	uint32_t A41 = 0;
	uint32_t A42 = 0;
	uint32_t A43 = 0;
	uint32_t A44 = 0;
	uint32_t A45 = 0;
	uint32_t A46 = 0;
	uint32_t A47 = 0;
	uint32_t A48 = 0;
	uint32_t A49 = 0;
	uint32_t A50 = 0;
	uint32_t A51 = 0;
	uint32_t A52 = 0;
	uint32_t A53 = 0;
	uint32_t A54 = 0;
	uint32_t A55 = 0;
	uint32_t A56 = 0;
	uint32_t A57 = 0;
	uint32_t A58 = 0;
	uint32_t A59 = 0;
	uint32_t A60 = 0;
	uint32_t A61 = 0;
	uint32_t A62 = 0;
	uint32_t A63 = 0;
	uint32_t A64 = 0;
	uint32_t A65 = 0;
	uint32_t A66 = 0;
	uint32_t A67 = 0;
	uint32_t A68 = 0;
	uint32_t A69 = 0;
	uint32_t A70 = 0;
	uint32_t A71 = 0;
	uint32_t A72 = 0;
	uint32_t A73 = 0;
	uint32_t A74 = 0;
	uint32_t A75 = 0;
	uint32_t A76 = 0;
	uint32_t A77 = 0;
	uint32_t A78 = 0;
	uint32_t A79 = 0;
	uint32_t A80 = 0;
	uint32_t A81 = 0;
	uint32_t A82 = 0;
	uint32_t A83 = 0;
	uint32_t A84 = 0;
	uint32_t A85 = 0;
	uint32_t A86 = 0;
	uint32_t A87 = 0;
	uint32_t A88 = 0;
	uint32_t A89 = 0;
	uint32_t A90 = 0;
	uint32_t A91 = 0;
	uint32_t A92 = 0;
	uint32_t A93 = 0;
	uint32_t A94 = 0;
	uint32_t A95 = 0;
	uint32_t A96 = 0;
	uint32_t A97 = 0;
	uint32_t A98 = 0;
	uint32_t A99 = 0;
	uint32_t A100 = 0;
	uint32_t A101 = 0;
	uint32_t A102 = 0;
	uint32_t A103 = 0;
	uint32_t A104 = 0;
	uint32_t A105 = 0;
	uint32_t A106 = 0;
	uint32_t A107 = 0;
	uint32_t A108 = 0;
	uint32_t A109 = 0;
	uint32_t A110 = 0;
	uint32_t A111 = 0;
	uint32_t A112 = 0;
	uint32_t A113 = 0;
	uint32_t A114 = 0;
	uint32_t A115 = 0;
	uint32_t A116 = 0;
	uint32_t A117 = 0;
	uint32_t A118 = 0;
	uint32_t A119 = 0;
	uint32_t A120 = 0;
	uint32_t A121 = 0;
	uint32_t A122 = 0;
	uint32_t A123 = 0;
	uint32_t A124 = 0;
	uint32_t A125 = 0;
	uint32_t A126 = 0;
	uint32_t A127 = 0;
	uint32_t A128 = 0;
	uint32_t A129 = 0;
	uint32_t A130 = 0;
	uint32_t A131 = 0;
	uint32_t A132 = 0;
	uint32_t A133 = 0;
	uint32_t A134 = 0;
	uint32_t A135 = 0;
	uint32_t A136 = 0;
	uint32_t A137 = 0;
	uint32_t A138 = 0;
	uint32_t A139 = 0;
	uint32_t A140 = 0;
	uint32_t A141 = 0;
	uint32_t A142 = 0;
	uint32_t A143 = 0;
	uint32_t A144 = 0;
	uint32_t A145 = 0;
	uint32_t A146 = 0;
	uint32_t A147 = 0;
	uint32_t A148 = 0;
	uint32_t A149 = 0;
	uint32_t A150 = 0;
	uint32_t A151 = 0;
	uint32_t A152 = 0;
	uint32_t A153 = 0;
	uint32_t A154 = 0;
	uint32_t A155 = 0;
	uint32_t A156 = 0;
	uint32_t A157 = 0;
	uint32_t A158 = 0;
	uint32_t A159 = 0;
	uint32_t A160 = 0;
	uint32_t A161 = 0;
	uint32_t A162 = 0;
	uint32_t A163 = 0;
	uint32_t A164 = 0;
	uint32_t A165 = 0;
	uint32_t A166 = 0;
	uint32_t A167 = 0;
	uint32_t A168 = 0;
	uint32_t A169 = 0;
	uint32_t A170 = 0;
	uint32_t A171 = 0;
	uint32_t A172 = 0;
	uint32_t A173 = 0;
	uint32_t A174 = 0;
	uint32_t A175 = 0;
	uint32_t A176 = 0;
	uint32_t A177 = 0;
	uint32_t A178 = 0;
	uint32_t A179 = 0;
	uint32_t A180 = 0;
	uint32_t A181 = 0;
	uint32_t A182 = 0;
	uint32_t A183 = 0;
	uint32_t A184 = 0;
	uint32_t A185 = 0;
	uint32_t A186 = 0;
	uint32_t A187 = 0;
	uint32_t A188 = 0;
	uint32_t A189 = 0;
	uint32_t A190 = 0;
	uint32_t A191 = 0;
	uint32_t A192 = 0;
	uint32_t A193 = 0;
	uint32_t A194 = 0;
	uint32_t A195 = 0;
	uint32_t A196 = 0;
	uint32_t A197 = 0;
	uint32_t A198 = 0;
	uint32_t A199 = 0;
	uint32_t A200 = 0;
	uint32_t A201 = 0;
	uint32_t A202 = 0;
	uint32_t A203 = 0;
	uint32_t A204 = 0;
	uint32_t A205 = 0;
	uint32_t A206 = 0;
	uint32_t A207 = 0;
	uint32_t A208 = 0;
	uint32_t A209 = 0;
	uint32_t A210 = 0;
	uint32_t A211 = 0;
	uint32_t A212 = 0;
	uint32_t A213 = 0;
	uint32_t A214 = 0;
	uint32_t A215 = 0;
	uint32_t A216 = 0;
	uint32_t A217 = 0;
	uint32_t A218 = 0;
	uint32_t A219 = 0;
	uint32_t A220 = 0;
	uint32_t A221 = 0;
	uint32_t A222 = 0;
	uint32_t A223 = 0;
	uint32_t A224 = 0;
	uint32_t A225 = 0;
	uint32_t A226 = 0;
	uint32_t A227 = 0;
	uint32_t A228 = 0;
	uint32_t A229 = 0;
	uint32_t A230 = 0;
	uint32_t A231 = 0;
	uint32_t A232 = 0;
	uint32_t A233 = 0;
	uint32_t A234 = 0;
	uint32_t A235 = 0;
	uint32_t A236 = 0;
	uint32_t A237 = 0;
	uint32_t A238 = 0;
	uint32_t A239 = 0;
	uint32_t A240 = 0;
	uint32_t A241 = 0;
	uint32_t A242 = 0;
	uint32_t A243 = 0;
	uint32_t A244 = 0;
	uint32_t A245 = 0;
	uint32_t A246 = 0;
	uint32_t A247 = 0;
	uint32_t A248 = 0;
	uint32_t A249 = 0;
} SWH_Structure;

class SWH : public MB
{
public:
	SWH(Device_Info_Structure t, RS485Driver *r) : MB(t, r)
	{
		id = id_count++;
		del = destructor;
		status = false;

		if (t.type == Device_Modbus_RTU)
		{
			log_d("Add reg");
			rtu->addHreg(40001, 0, 510);
			rtu->unitID = t.info.RTU.ID;
		}

		if (Task_t == NULL)
		{
			xTaskCreate(this->_Task, "SWH Task", 8096, this, 12, &Task_t);
		}
	}
	~SWH()
	{
	}
	bool load()
	{	d = {};
		rtu->getMultipleWords((uint8_t *)&d, HREG(40001), 500);
		return true;
	}

	String toString()
	{
		return getString();
	}

private:
	static TaskHandle_t Task_t;
	static void destructor()
	{
		vTaskDelete(Task_t);
		Task_t = NULL;
		id_count--;
	}
	bool status = false;
	uint8_t local_id = 0;
	static int id_count;
	SWH_Structure d = {};
	void Task()
	{
		// log_d("Create task swh");
		for (;;)
		{
			rtu->process();
			delay(10);
		}
	}

	static void _Task(void *arg)
	{
		static_cast<SWH *>(arg)->Task();
	}
	float __swap_float(uint32_t i)
	{
		uint16_t ch = __bswap_16(i >> 16);
		uint16_t cl = __bswap_16((uint16_t)i);
		uint32_t f = (ch << 16) | (cl & 0xFFFFFFFF);
		return *(float *)&f;
	}
	String FloatToString(String key, float f)
	{
		if (f != 0.00)
		{
			return key + String(f);
		}
		return "";
	}
	String getString();
};

#endif